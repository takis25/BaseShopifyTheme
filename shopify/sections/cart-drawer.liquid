<div id="cart-drawer" class="cart-drawer">
  <div class="cart-drawer__overlay"></div>
  <div class="cart-drawer__content">
    <button class="cart-drawer__close">&times;</button>
    <h2>Your Cart</h2>
    <div class="cart-drawer__items">Loading...</div>
    <div class="cart-drawer__footer">
      <p class="cart-drawer__total"></p>
      <a href="/cart" class="btn">View Cart</a>
      <a href="/checkout" class="btn btn--primary">Checkout</a>
    </div>
  </div>
</div>

<style>
.cart-drawer {
  position: fixed;
  top: 0;
  right: 0;
  width: 100%;
  height: 100%;
  display: none;
  z-index: 1000;
}

.cart-drawer.active {
  display: block;
}

.cart-drawer__overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
}

.cart-drawer__content {
  position: absolute;
  top: 0;
  right: 0;
  width: 400px;
  max-width: 90%;
  height: 100%;
  background: #fff;
  padding: 2rem;
  overflow-y: auto;
  box-shadow: -4px 0 20px rgba(0, 0, 0, 0.25);
  border-radius: 8px 0 0 8px;
}

.cart-drawer__close {
  position: absolute;
  top: 10px;
  right: 16px;
  font-size: 28px;
  background: none;
  border: none;
  cursor: pointer;
}

.cart-drawer__items {
  margin-top: 2rem;
  margin-bottom: 2rem;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  border-bottom: 1px solid #eee;
  padding-bottom: 0.75rem;
}

.cart-item p {
  margin: 0;
}

.remove-item {
  background: transparent;
  color: #c00;
  border: none;
  font-size: 14px;
  cursor: pointer;
  text-decoration: underline;
}

.cart-drawer__footer .btn {
  display: block;
  width: 100%;
  margin-bottom: 1rem;
  padding: 0.75rem;
  text-align: center;
  background-color: #007aff;
  color: white;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  font-weight: bold;
  transition: background-color 0.2s ease;
}

.cart-drawer__footer .btn:hover {
  background-color: #005ec4;
}

.cart-drawer__footer .btn--primary {
  background-color: #1c5cfc;
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const drawer = document.getElementById('cart-drawer');
    const overlay = drawer.querySelector('.cart-drawer__overlay');
    const closeBtn = drawer.querySelector('.cart-drawer__close');
    const itemsContainer = drawer.querySelector('.cart-drawer__items');
    const totalDisplay = drawer.querySelector('.cart-drawer__total');

    function openCartDrawer() {
      drawer.classList.add('active');
      fetch('/cart.js')
        .then(res => res.json())
        .then(cart => {
          if (cart.items.length === 0) {
            itemsContainer.innerHTML = '<p>Your cart is empty.</p>';
            totalDisplay.textContent = '';
          } else {
            itemsContainer.innerHTML = cart.items.map(item => `
              <div class="cart-item" data-line-item-id="${item.key}">
                <div>
                  <p><strong>${item.product_title}</strong> x ${item.quantity}</p>
                  <p>${(item.line_price / 100).toFixed(2)} ${cart.currency}</p>
                </div>
                <button class="remove-item" data-key="${item.key}">Remove</button>
              </div>
            `).join('');
            totalDisplay.textContent = `Total: ${(cart.total_price / 100).toFixed(2)} ${cart.currency}`;

            // Attach remove event handlers
            const removeButtons = drawer.querySelectorAll('.remove-item');
            removeButtons.forEach(btn => {
              btn.addEventListener('click', function () {
                const key = btn.getAttribute('data-key');
                fetch('/cart/change.js', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                  },
                  body: JSON.stringify({ id: key, quantity: 0 })
                })
                .then(() => openCartDrawer());
              });
            });
          }
        });
    }

    function closeCartDrawer() {
      drawer.classList.remove('active');
    }

    window.openCartDrawer = openCartDrawer;
    overlay.addEventListener('click', closeCartDrawer);
    closeBtn.addEventListener('click', closeCartDrawer);
  });
</script>
